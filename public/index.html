<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Lista</title>
</head>
<body>

<form id="f">
  <input id="q" placeholder="Buscar" required>
  <select id="category">
    <option value="">Sin categoría</option>
    <option value="almacen">Almacén</option>
    <option value="limpieza">Limpieza</option>
  </select>
  <button>Buscar</button>
</form>

<ul id="r"></ul>

<script>
const f = document.getElementById("f");
const r = document.getElementById("r");
const cat = document.getElementById("category");

f.onsubmit = async e => {
  e.preventDefault();
  r.innerHTML = "Buscando...";
  const q = document.getElementById("q").value;
  const res = await fetch("/search?q=" + encodeURIComponent(q));
  const data = await res.json();
  r.innerHTML = "";
  data.forEach(p => {
    const li = document.createElement("li");
    li.innerHTML = `${p.name}
      <button onclick='add(${JSON.stringify(p)})'>Agregar</button>`;
    r.appendChild(li);
  });
};

async function add(p){
  const res = await fetch("/add",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      name: p.name,
      image: p.image,
      source: p.source,
      link: p.link,
      category: cat.value
    })
  });
  console.log(await res.json());
}
</script>

</body>
</html>
