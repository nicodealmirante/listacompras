<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Buscador</title>
<style>
body{font-family:Arial;padding:20px}
li{margin:8px 0}
button{margin-left:10px}
img{vertical-align:middle}
</style>
</head>
<body>

<h3>Buscar productos</h3>

<form id="f">
  <input id="q" placeholder="Buscar..." required>

  <select id="category">
    <option value="Higiene y Salud">Higiene y Salud</option>
    <option value="Almacen">AlmacÃ©n</option>
    <option value="Electro">Electro</option>
  </select>

  <button>Buscar</button>
</form>

<ul id="r"></ul>

<script>
const f = document.getElementById("f");
const r = document.getElementById("r");
const cat = document.getElementById("category");

f.onsubmit = async e => {
  e.preventDefault();
  r.innerHTML = "Buscando...";

  const q = document.getElementById("q").value;
  const res = await fetch("/search?q=" + encodeURIComponent(q));
  const data = await res.json();

  r.innerHTML = "";
  data.forEach(p => {
    const li = document.createElement("li");
    li.innerHTML = `
      <img src="${p.image}" width="50">
      ${p.name}
      <button onclick='add(${JSON.stringify(p)})'>Agregar</button>
    `;
    r.appendChild(li);
  });
};

async function add(p){
  const payload = {
    name: p.name,
    image: p.image,
    source: p.source,
    link: p.link,
    category: cat.value,
    price: Number(p.price || p.basePrice || 0) // ðŸ‘ˆ CLAVE
  };

  await fetch("/add",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });

  alert("Agregado");
}
  const res = await fetch("/add",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });

  const json = await res.json();
  console.log(json);
  alert("Agregado");
}
</script>

</body>
</html>
