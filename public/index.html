<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Buscador</title>
<style>
body{font-family:Arial;padding:20px}
li{margin:8px 0}
button{margin-left:10px}
</style>
</head>
<body>

<h3>Buscar productos</h3>

<form id="f">
  <input id="q" placeholder="Buscar..." required>
  <button>Buscar</button>
</form>

<ul id="r"></ul>

<script>
const f = document.getElementById("f");
const r = document.getElementById("r");

f.onsubmit = async e => {
  e.preventDefault();
  r.innerHTML = "Buscando...";

  const q = document.getElementById("q").value;
  const res = await fetch("/search?q=" + encodeURIComponent(q));
  const data = await res.json();

  r.innerHTML = "";
  data.forEach(p => {
    const li = document.createElement("li");
  li.innerHTML = `
  <img src="${p.image}" width="50" style="vertical-align:middle">
  ${p.name}
  <button onclick='add(${JSON.stringify(p)})'>Agregar</button>
`;

    r.appendChild(li);
  });
};

async function add(p){
  await fetch("/add",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(p)
  });
  alert("Agregado");
}
</script>

</body>
</html>
